# Data Model: Integrated RAG Chatbot for AI-Native Physical AI & Humanoid Robotics Textbook

**Feature**: 2-integrated-rag-chatbot
**Date**: 2025-12-17

## Overview

This document defines the data models for the RAG chatbot system, derived from the feature specification and constitutional requirements.

## Entity: Question

**Description**: A query submitted by a user, containing text content and context information

**Fields**:
- `id` (string): Unique identifier for the question
- `content` (string): The actual question text from the user
- `mode` (enum): Question answering mode ('full-book' or 'selected-text')
- `selected_text` (string, optional): Text selected by user (only for selected-text mode)
- `current_page` (string, optional): Current page/chapter context
- `timestamp` (datetime): When the question was submitted
- `user_session_id` (string): Reference to the user session

**Validation Rules**:
- Content must not be empty
- Mode must be one of the allowed values
- If mode is 'selected-text', selected_text must not be empty

## Entity: Response

**Description**: The chatbot's answer, containing the answer text, source references, and confidence indicators

**Fields**:
- `id` (string): Unique identifier for the response
- `question_id` (string): Reference to the original question
- `content` (string): The answer text generated by the system
- `source_references` (array): List of source references (chapter/section)
- `confidence` (number): Confidence score for the response (0-1)
- `timestamp` (datetime): When the response was generated
- `user_session_id` (string): Reference to the user session

**Validation Rules**:
- Content must not be empty
- Source references must be properly formatted with chapter/section information
- Confidence must be between 0 and 1

## Entity: Textbook Content

**Description**: The source material from which answers are generated, organized by chapters, sections, and metadata

**Fields**:
- `id` (string): Unique identifier for the content chunk
- `content` (string): The actual text content
- `chapter` (string): Chapter identifier
- `section` (string): Section identifier
- `source_file` (string): Original source file
- `metadata` (object): Additional metadata (author, page numbers, etc.)
- `embedding` (array): Vector embedding of the content
- `created_at` (datetime): When the content was indexed

**Validation Rules**:
- Content must not be empty
- Chapter and section must be properly formatted
- Source file must be a valid reference
- Embedding must be a valid vector array

## Entity: User Session

**Description**: Temporary data tracking the current interaction state, including conversation history and mode settings

**Fields**:
- `id` (string): Unique identifier for the session
- `user_id` (string, optional): Identifier for the user (if available)
- `current_mode` (enum): Current question answering mode
- `conversation_history` (array): List of previous questions and responses
- `created_at` (datetime): When the session was created
- `last_activity` (datetime): When the session was last used

**Validation Rules**:
- Current mode must be one of the allowed values
- Conversation history should be limited to prevent excessive storage

## Entity: Chunk Reference

**Description**: Reference information for a specific chunk of content used in response generation

**Fields**:
- `chunk_id` (string): Reference to the textbook content chunk
- `question_id` (string): Reference to the question that used this chunk
- `relevance_score` (number): How relevant this chunk was to the question (0-1)
- `used_in_response` (boolean): Whether this chunk was used in the final response

**Validation Rules**:
- Relevance score must be between 0 and 1
- Chunk ID must reference an existing textbook content
- Question ID must reference an existing question

## Relationships

1. **User Session** 1 → * **Question**: A session can have multiple questions
2. **Question** 1 → 1 **Response**: Each question has one response
3. **Response** 1 → * **Chunk Reference**: A response can reference multiple chunks
4. **Chunk Reference** * → 1 **Textbook Content**: Multiple references can point to the same content chunk